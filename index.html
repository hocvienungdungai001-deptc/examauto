<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VDC LAN Grader v1.3</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #007bff;
            --success: #28a745;
            --danger: #dc3545;
            --bg: #f0f2f5;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background: var(--bg);
            margin: 0;
            padding: 15px;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 450px;
            text-align: center;
        }

        h2 {
            margin-top: 0;
            color: var(--primary);
            font-size: 24px;
        }

        /* Khu v·ª±c nh·∫≠p IP */
        .config-area {
            background: #e9ecef;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: left;
        }
        
        .config-label {
            font-size: 12px;
            font-weight: bold;
            color: #555;
            margin-bottom: 5px;
            display: block;
        }

        .ip-input-group {
            display: flex;
            gap: 5px;
        }

        #ipInput {
            flex: 1;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-family: monospace;
            font-size: 16px;
        }

        /* N√∫t ch·ª•p ·∫£nh to ƒë·∫πp */
        .btn-camera {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            width: 100%;
            padding: 20px;
            border: none;
            border-radius: 15px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,123,255,0.4);
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-camera:active {
            transform: scale(0.98);
            box-shadow: 0 2px 5px rgba(0,123,255,0.3);
        }

        .btn-camera svg {
            width: 30px;
            height: 30px;
            fill: white;
        }

        /* Khu v·ª±c hi·ªÉn th·ªã k·∫øt qu·∫£ */
        #resultBox {
            margin-top: 25px;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .score-display {
            font-size: 60px;
            font-weight: 700;
            color: var(--success);
            line-height: 1;
        }

        .status-text {
            margin-top: 10px;
            font-size: 16px;
            font-weight: 500;
        }
        
        .cloud-sync {
            font-size: 13px;
            color: #666;
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
            background: #f8f9fa;
            padding: 5px 10px;
            border-radius: 20px;
        }

        /* Input ·∫©n */
        #fileInput { display: none; }

        /* Animation xoay xoay khi ƒëang load */
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="card">
    <h2>üöÄ VDC LAN GRADER v1.3</h2>
    
    <div class="config-area">
        <label class="config-label">ƒê·ªäA CH·ªà IP LAPTOP (Xem b·∫±ng l·ªánh 'ipconfig'):</label>
        <div class="ip-input-group">
            <input type="text" id="ipInput" placeholder="VD: 192.168.1.5" value="192.168.1.">
        </div>
        <div style="font-size: 11px; color: #666; margin-top: 5px;">*C·∫ßn k·∫øt n·ªëi c√πng m·∫°ng Wifi</div>
    </div>

    <button class="btn-camera" onclick="triggerCamera()">
        <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/><path d="M0 0h24v24H0z" fill="none"/></svg>
        CH·ª§P B√ÄI THI
    </button>
    
    <input type="file" id="fileInput" accept="image/*" capture="environment" onchange="uploadToLaptop(this)">

    <div id="resultBox">
        <div style="color: #999; font-style: italic;">S·∫µn s√†ng ch·∫•m thi...</div>
    </div>
</div>

<script>
    // 1. T·ª± ƒë·ªông t·∫£i IP ƒë√£ l∆∞u l·∫ßn tr∆∞·ªõc
    const ipInput = document.getElementById('ipInput');
    const savedIP = localStorage.getItem('vdc_laptop_ip');
    if (savedIP) {
        ipInput.value = savedIP;
    }

    // 2. H√†m k√≠ch ho·∫°t Camera
    function triggerCamera() {
        // L∆∞u IP l·∫°i tr∆∞·ªõc khi ch·ª•p
        localStorage.setItem('vdc_laptop_ip', ipInput.value);
        document.getElementById('fileInput').click();
    }

    // 3. H√†m g·ª≠i ·∫£nh sang Laptop (LAN)
    async function uploadToLaptop(input) {
        if (input.files.length === 0) return;
        const file = input.files[0];
        
        // Giao di·ªán ƒëang x·ª≠ l√Ω
        const resultBox = document.getElementById('resultBox');
        resultBox.innerHTML = `
            <div class="loader"></div>
            <div class="status-text" style="color: #007bff;">ƒêang b·∫Øn ·∫£nh sang Laptop...</div>
        `;

        // Chu·∫©n b·ªã IP
        let laptopIP = ipInput.value.trim();
        if (!laptopIP.startsWith('http')) {
            laptopIP = 'http://' + laptopIP; // T·ª± th√™m http n·∫øu thi·∫øu
        }
        if (!laptopIP.includes(':5000')) {
            laptopIP = laptopIP + ':5000'; // T·ª± th√™m port n·∫øu thi·∫øu
        }

        const formData = new FormData();
        formData.append("file", file);

        try {
            // G·ª≠i request POST
            const response = await fetch(`${laptopIP}/upload`, {
                method: "POST",
                body: formData
            });

            if (!response.ok) throw new Error("Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c Laptop (Ki·ªÉm tra IP/Firewall)");

            const result = await response.json();
            
            // HI·ªÇN TH·ªä K·∫æT QU·∫¢
            resultBox.innerHTML = `
                <div class="score-display">${result.score}</div>
                <div class="status-text" style="color: var(--success);">ƒê√É C√ì ƒêI·ªÇM!</div>
                <div class="cloud-sync">
                    <span>‚òÅÔ∏è</span> ƒêang ng·∫ßm l∆∞u l√™n Drive & Firebase...
                </div>
            `;

        } catch (error) {
            console.error(error);
            resultBox.innerHTML = `
                <div style="font-size: 40px;">‚ùå</div>
                <div class="status-text" style="color: var(--danger);">L·ªói k·∫øt n·ªëi!</div>
                <div style="font-size: 12px; color: #666; margin-top:5px;">
                    1. Ki·ªÉm tra IP Laptop.<br>
                    2. T·∫Øt t∆∞·ªùng l·ª≠a (Firewall).<br>
                    3. ƒê·∫£m b·∫£o c√πng Wifi.
                </div>
            `;
        }

        // Reset input ƒë·ªÉ ch·ªçn l·∫°i file c≈© ƒë∆∞·ª£c
        input.value = '';
    }
</script>

</body>
</html>
