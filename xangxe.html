<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tính Lộ Trình Kiểm Tra Tuyến Dây - v1.0</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; padding: 20px; }
        #map { height: 400px; width: 100%; border-radius: 10px; margin-top: 20px; }
        .result-panel { background: white; padding: 20px; border-radius: 10px; shadow: 0 2px 5px rgba(0,0,0,0.1); }
    </style>
</head>
<body>

<div class="container">
    <h2 class="text-primary mb-4">Lập Kế Hoạch Lộ Trình Kiểm Tra</h2>
    
    <div class="row">
        <div class="col-md-4">
            <div class="result-panel border">
                <h5>Cài đặt điểm đến</h5>
                <div class="mb-3">
                    <label class="form-label">Điểm xuất phát:</label>
                    <input type="text" class="form-control" value="113 Phổ Quang, Tân Bình" disabled>
                </div>
                <div class="mb-3">
                    <label class="form-label">Tọa độ đích (Lat, Lng):</label>
                    <input type="text" id="destinationCoords" class="form-control" placeholder="Ví dụ: 10.811, 106.674">
                    <small class="text-muted">Nhập tọa độ trụ điện (Ví dụ: CA1V)</small>
                </div>
                <button onclick="calculateRoute()" class="btn btn-success w-100">Tính chiều dài lộ trình</button>
                
                <hr>
                <div id="results" class="mt-3" style="display:none;">
                    <p><strong>Quãng đường:</strong> <span id="distanceText" class="text-danger">0 km</span></p>
                    <p><strong>Thời gian đi xe máy:</strong> <span id="durationText">0 phút</span></p>
                </div>
            </div>
        </div>
        <div class="col-md-8">
            <div id="map"></div>
        </div>
    </div>
</div>

<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap" async defer></script>

<script>
    let map, directionsService, directionsRenderer;
    const originLocation = { lat: 10.8068, lng: 106.6698 }; // Tọa độ 113 Phổ Quang

    function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
            zoom: 15,
            center: originLocation
        });

        directionsService = new google.maps.DirectionsService();
        directionsRenderer = new google.maps.DirectionsRenderer();
        directionsRenderer.setMap(map);

        // Marker điểm gốc
        new google.maps.Marker({
            position: originLocation,
            map: map,
            title: "113 Phổ Quang"
        });
    }

    function calculateRoute() {
        const coordInput = document.getElementById('destinationCoords').value;
        const coords = coordInput.split(',');
        
        if (coords.length !== 2) {
            alert("Vui lòng nhập đúng định dạng: Kinh độ, Vĩ độ");
            return;
        }

        const destLocation = {
            lat: parseFloat(coords[0].trim()),
            lng: parseFloat(coords[1].trim())
        };

        const request = {
            origin: originLocation,
            destination: destLocation,
            travelMode: 'TWO_WHEELER' // Chế độ xe máy
        };

        directionsService.route(request, function(result, status) {
            if (status == 'OK') {
                directionsRenderer.setDirections(result);
                
                const route = result.routes[0].legs[0];
                document.getElementById('results').style.display = 'block';
                document.getElementById('distanceText').innerText = route.distance.text;
                document.getElementById('durationText').innerText = route.duration.text;
            } else {
                alert("Không thể tìm thấy lộ trình: " + status);
            }
        });
    }
</script>

</body>
</html>
