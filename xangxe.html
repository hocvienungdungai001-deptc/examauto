<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kiểm tra Tuyến Dây - v1.1</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f7f6; }
        #map { height: 500px; width: 100%; border-radius: 12px; border: 2px solid #dee2e6; }
        .config-warning { font-size: 0.85rem; color: #856404; background-color: #fff3cd; padding: 10px; border-radius: 5px; margin-bottom: 15px; }
    </style>
</head>
<body>

<div class="container py-4">
    <div class="row">
        <div class="col-md-4">
            <div class="card shadow-sm p-3">
                <h4 class="text-primary">Lộ trình Xe máy</h4>
                <div class="config-warning">
                    <strong>Lưu ý:</strong> Đảm bảo API Key trong mã nguồn đã được bật "Maps JavaScript API" và "Directions API".
                </div>
                
                <div class="mb-3">
                    <label class="form-label font-weight-bold">Từ: 113 Phổ Quang</label>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Tọa độ đích (Lat, Lng):</label>
                    <input type="text" id="destinationCoords" class="form-control" placeholder="10.8115, 106.6742">
                </div>
                
                <button onclick="calculateRoute()" class="btn btn-primary w-100">Tính quãng đường</button>

                <div id="results" class="mt-4 p-3 bg-light rounded" style="display:none;">
                    <div class="d-flex justify-content-between">
                        <span>Khoảng cách:</span>
                        <strong id="distanceText" class="text-danger">-</strong>
                    </div>
                    <div class="d-flex justify-content-between mt-2">
                        <span>Thời gian di chuyển:</span>
                        <strong id="durationText">-</strong>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-8">
            <div id="map"></div>
            <div id="error-message" class="text-danger mt-2"></div>
        </div>
    </div>
</div>

<script>
    // Firebase Config của bạn (dùng để quản lý nếu cần mở rộng sau này)
    const firebaseConfig = { 
        apiKey: "AIzaSyCzWjfcD5Dgq7V-i2izb9tKLR6QM6qWPQo", 
        authDomain: "tavietnam-78ae8.firebaseapp.com", 
        projectId: "tavietnam-78ae8", 
        storageBucket: "tavietnam-78ae8.firebasestorage.app", 
        messagingSenderId: "670121705534", 
        appId: "1:670121705534:web:1027ad98550573ad37116f" 
    };

    let map, directionsService, directionsRenderer;
    const originLocation = { lat: 10.8068, lng: 106.6698 }; // 113 Phổ Quang

    function initMap() {
        try {
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 14,
                center: originLocation,
                mapTypeControl: false
            });

            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer();
            directionsRenderer.setMap(map);
        } catch (e) {
            document.getElementById('error-message').innerText = "Lỗi khởi tạo bản đồ. Kiểm tra lại API Key.";
        }
    }

    function calculateRoute() {
        const input = document.getElementById('destinationCoords').value;
        const parts = input.split(',');
        
        if (parts.length !== 2) {
            alert("Vui lòng nhập định dạng: Vĩ độ, Kinh độ");
            return;
        }

        const dest = { lat: parseFloat(parts[0]), lng: parseFloat(parts[1]) };

        directionsService.route({
            origin: originLocation,
            destination: dest,
            travelMode: google.maps.TravelMode.TWO_WHEELER
        }, (response, status) => {
            if (status === 'OK') {
                directionsRenderer.setDirections(response);
                const data = response.routes[0].legs[0];
                document.getElementById('results').style.display = 'block';
                document.getElementById('distanceText').innerText = data.distance.text;
                document.getElementById('durationText').innerText = data.duration.text;
            } else {
                alert("Lỗi Directions API: " + status);
            }
        });
    }
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCzWjfcD5Dgq7V-i2izb9tKLR6QM6qWPQo&callback=initMap" async defer></script>

</body>
</html>
